module.exports=function(e){var n={};function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=n,i.d=function(e,n,t){i.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,n){if(1&n&&(e=i(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)i.d(t,r,function(n){return e[n]}.bind(null,r));return t},i.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(n,"a",n),n},i.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},i.p="",i(i.s=0)}([function(e,n,i){"use strict";i.r(n);var t={};function r(e){if("Boolean"===e.type||"Integer"===e.type)return{name:e.name,value:e.value};if("String"===e.type||"ByteArray"===e.type||"Long"===e.type||"Address"===e.type)return{name:e.name,value:e.type+":"+e.value};if("Array"===e.type)return{name:e.name,value:e.value.map(e=>r(e))};if("Map"===e.type){const n={};for(const i of Object.keys(e.value))n[i]=r(e.value[i]);return{name:e.name,value:n}}throw new Error("Invalid parmeter type: "+JSON.stringify(e))}function a(e,n){const i=[];for(const e of n)i.push(r(e));return{operation:e,args:i}}function o(){return Math.random().toString(36).substring(2,10)}i.r(t),i.d(t,"registerClient",(function(){return c})),i.d(t,"api",(function(){return p}));var s=class{constructor(e){this.timeout=3e3,this.version="v1.0.0",this.handlers={},e&&(this.timeout=e),this.injected=!1,this.pendingMsgs=[]}call(e){const n=o();return e.id=n,new Promise((i,t)=>{const r="ontprovider://ont.io?params="+btoa(encodeURIComponent(JSON.stringify(e)));this.sendMessage(r),this.handleMessageEvent(n,i,t,e.action,e.needTimeout)})}invokeRead(){throw new Error("invokeRead not supported yet.")}parseMessage(e){return JSON.parse(decodeURIComponent(atob(e)))}onMessage(e){this.listener&&this.offMessage();const n=n=>{const i=this.parseMessage(n.data);e(i)};window.document.addEventListener("message",n),this.listener=n}offMessage(){window.document.removeEventListener("message",this.listener)}sendMessage(e){this.injected?window.postMessage(e,"*"):this.checkInterval?this.pendingMsgs.push(e):this.checkInterval=window.setInterval(()=>{window.originalPostMessage&&(window.postMessage(e,"*"),this.injected=!0,this.pendingMsgs.forEach(e=>{window.postMessage(e,"*")}),window.clearInterval(this.checkInterval))},100)}handleMessageEvent(e,n,i,t,r=!1){const a=this,o=function(e){const r=e.data;r||i(e);const s=a.parseMessage(r);s.id||i("No message id"),a.handlers[s.id]||i("No message handler"),s.id===o.id&&(document.removeEventListener("message",a.handlers[s.id]),delete a.handlers[s.id],s.action===t?n(s):i(s))};o.id=e,this.handlers[e]=o,document.addEventListener("message",this.handlers[e]),r&&setTimeout(()=>{i("Time out")},this.timeout)}};let g;function c(e=3e3){g=new s(e)}async function u(e){return g.call(e)}const m={invoke(e){if(!e.scriptHash||!e.operation||!e.args)throw new Error("Invalid params.");if(!e.payer)throw new Error("No payer.");e.config||(e.config={login:!0,message:"",url:""});const n=a(e.operation,e.args);return u({action:"invoke",version:"1.0.0",params:{login:e.config.login,url:e.config.url,message:e.config.message,invokeConfig:{contractHash:e.scriptHash,functions:[n],payer:e.payer,gasPrice:e.gasPrice?e.gasPrice:500,gasLimit:e.gasLimit?e.gasLimit:2e4}}})},invokeRead(e){if(!e.scriptHash||!e.operation||!e.args)throw new Error("Invalid params.");e.config||(e.config={login:!0,message:"",url:""});const n=a(e.operation,e.args);return u({action:"invokeRead",version:"1.0.0",params:{login:e.config.login,url:e.config.url,message:e.config.message,invokeConfig:{contractHash:e.scriptHash,functions:[n],payer:e.payer,gasPrice:e.gasPrice?e.gasPrice:500,gasLimit:e.gasLimit?e.gasLimit:2e4}}})},invokePasswordFree(e){if(!e.scriptHash||!e.operation||!e.args||0===e.args.length)throw new Error("Invalid params.");if(!e.payer)throw new Error("No payer.");e.config||(e.config={login:!0,message:"",url:""});const n=a(e.operation,e.args);return u({action:"invokePasswordFree",version:"1.0.0",params:{login:e.config.login,url:e.config.url,message:e.config.message,invokeConfig:{contractHash:e.scriptHash,functions:[n],payer:e.payer,gasPrice:e.gasPrice?e.gasPrice:500,gasLimit:e.gasLimit?e.gasLimit:2e4}}})},invokeWasm(e){if(!e.scriptHash||!e.operation||!e.args)throw new Error("Invalid params.");if(!e.payer)throw new Error("No payer.");e.config||(e.config={login:!0,message:"",url:""});const n=a(e.operation,e.args);return u({action:"invokeWasm",version:"1.0.0",params:{login:e.config.login,url:e.config.url,message:e.config.message,invokeConfig:{contractHash:e.scriptHash,functions:[n],payer:e.payer,gasPrice:e.gasPrice?e.gasPrice:500,gasLimit:e.gasLimit?e.gasLimit:2e4}}})},invokeWasmRead(e){if(!e.scriptHash||!e.operation||!e.args)throw new Error("Invalid params.");e.config||(e.config={login:!0,message:"",url:""});const n=a(e.operation,e.args);return u({action:"invokeWasmRead",version:"1.0.0",params:{login:e.config.login,url:e.config.url,message:e.config.message,invokeConfig:{contractHash:e.scriptHash,functions:[n],payer:e.payer,gasPrice:e.gasPrice?e.gasPrice:500,gasLimit:e.gasLimit?e.gasLimit:2e4}}})},invokeWasmPasswordFree(e){if(!e.scriptHash||!e.operation||!e.args||0===e.args.length)throw new Error("Invalid params.");if(!e.payer)throw new Error("No payer.");e.config||(e.config={login:!0,message:"",url:""});const n=a(e.operation,e.args);return u({action:"invokeWasmPasswordFree",version:"1.0.0",params:{login:e.config.login,url:e.config.url,message:e.config.message,invokeConfig:{contractHash:e.scriptHash,functions:[n],payer:e.payer,gasPrice:e.gasPrice?e.gasPrice:500,gasLimit:e.gasLimit?e.gasLimit:2e4}}})}},p={asset:{getAccount:e=>u({action:"getAccount",version:"1.0.0",params:e,needTimeout:!!e&&e.needTimeout}),transfer({from:e,to:n,asset:i,amount:t,gasPrice:r,gasLimit:a}){const o={scriptHash:"ONT"===i?"0100000000000000000000000000000000000000":"0200000000000000000000000000000000000000",operation:"transfer",args:[{name:"from",type:"Address",value:e},{name:"to",type:"Address",value:n},{name:"amount",type:"Long",value:t}],gasPrice:500,gasLimit:2e4,payer:e};return m.invoke(o)}},identity:{getIdentity:e=>u({action:"getIdentity",version:"1.0.0",params:e,needTimeout:!!e&&e.needTimeout}),authentication:e=>u({action:"authentication",version:"1.0.0",params:e}),authorization:e=>u({action:"authorization",version:"1.0.0",params:e}),registerOntId({ontid:e,publicKey:n,payer:i,gasPrice:t,gasLimit:r}){const a={scriptHash:"0300000000000000000000000000000000000000",operation:"regIDWithPublicKey",args:[{name:"ontid",type:"String",value:e},{name:"pk",type:"ByteArray",value:n}],gasPrice:500,gasLimit:2e4,payer:i};return m.invoke(a)},getDDO(e){const n={scriptHash:"0300000000000000000000000000000000000000",operation:"getDDO",args:[{name:"ontid",type:"String",value:e}],gasPrice:500,gasLimit:2e4};return m.invokeRead(n)}},message:{signMessage:e=>u({action:"signMessage",version:"1.0.0",params:e,needTimeout:!1}),login(e){if(!e.message||"string"!=typeof e.message)throw new Error("Parameter for login must contain a message.");return e.type||(e.type="account"),u({action:"login",version:"1.0.0",params:e,needTimeout:!1})}},mobile:{getData:e=>u({action:"getData",version:"1.0.0",params:e,needTimeout:!1}),doAction:e=>u({action:"doAction",version:"1.0.0",params:e,needTimeout:!1}),gotoWebview:e=>u({action:"gotoWebview",version:"1.0.0",params:e,needTimeout:!1}),gotoNative:e=>u({action:"gotoNative",version:"1.0.0",params:e,needTimeout:!1}),switchIdentity:()=>u({action:"switch_ontid",version:"1.0.0",needTimeout:!1}),switchDeviceCode:()=>u({action:"switch_device_code",version:"1.0.0",needTimeout:!1})},smartContract:m,qrcode:{login(e){if("ontid"!==e.type&&"account"!==e.type)throw new Error("Invalid parameter type "+e.type);const n={action:"login",version:"1.0.0",id:o(),params:e};return JSON.stringify(n)},invoke(e){const n={action:"invoke",version:"1.0.0",id:o(),params:e};return JSON.stringify(n)}},provider:{getProvider:()=>u({action:"getProvider",version:"1.0.0",needTimeout:!0})},stateChannel:{login:()=>u({action:"stateChannelLogin",version:"1.0.0",params:{},needTimeout:!1})}};i.d(n,"client",(function(){return t}))}]);
//# sourceMappingURL=index.js.map